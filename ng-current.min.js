!function(a){"use strict";var b=a.module("ng-current",[]);b.service("Contexts",["$log","$rootScope","$q",function(b,c,d){var e=this;this.contexts={},c.current={},this.register=function(a){this.contexts[a.name]=a.rels||[],a.refresh=e.refreshing(a),a.use=e.using(a),a.constructor.prototype=this.constructor.prototype,c.current[name]={}},this.refreshing=function(a){return function(c,d){var e=a[c];a.model||function(a){return a};e instanceof Function?e().then(function(b){d(b instanceof Array?b.map(a.model):a.model(b))}):b.error("[ng-current.refreshing] failed to find method on service",c)}},this.using=function(a){return function(c,d){a.constructor.prototype===this.constructor.prototype?(a.refresh(c,d),e.subscribe(a.name,function(b){a.refresh(c,d),a.rels&&a.rels.length&&a.rels.forEach(function(a){e.publish(a,b)})})):b.error("[ng-current.using] malformed Service context, please ensure you have added `Contexts.register(this)` at the end of this service",a)}},this.clear=function(a){(e.contexts[a]||[]).forEach(function(a){delete c.current[a];var b=e.contexts[a];b instanceof Array&&b.length&&b.forEach(e.clear)})},this.select=function(b,d){var f=c.current[b];a.equals(d,f)||(c.current[b]=d,e.clear(b),e.publish(b,d))},this.current=function(a){return c.current[a]},this.currentOr=function(b,c){var d=this.current(b);return a.isObject(d)||a.isUndefined(c)?d:c},this.get=e.current,this.getOr=e.currentOr,this.subscribe=function(a,b){return d(function(d,e){c.$on(a,function(a,c){d(b(c||{},a))})})},this.publish=function(a,b){var d=e.contexts[a],f=d?[a].concat(d):[a];f.forEach(function(a){if(a.constructor!==String)throw"rels must be Strings";c.$broadcast(a,b)})}}])}(angular),module&&exports&&module.exports===exports&&(module.exports="ng-current");